---
title: "kf-analysis"
author: "Kevin Robb"
date: "11/14/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# load relevant functions
source("functions/multiplot.R")
```


# Read in Data

```{r}
# read in the data from the file
dt = "2020-11-14-18-52-24"
filename = paste("./data/kf_data_", dt,".csv", sep="")
df=read.csv(filename)
names(df) <- c("x_meas","y_meas","xdot_meas","ydot_meas","theta_meas","yaw_rate_meas","x_pred","y_pred","xdot_pred","ydot_pred","theta_pred","yaw_rate_pred","x","y","xdot","ydot","theta","yaw_rate")
# add a timestep independent variable
t = c(1:length(df$x_meas))
df <- cbind(t, df)
head(df)
```

# Plot each variable's measurement, prediction, and state value

```{r eval=FALSE}
## couldn't get tidyverse to install in ubuntu
# Data preparation
# library(tidyverse)
# df_x <- df %>%
#   select(t, x_meas, x_pred, x) %>%
#   gather(key = "variable", value = "value", -t)
# head(df)
```


```{r}
# load relevant functions
source("functions/multiplot.R")
library(ggplot2)
# setup layout
numPlots = 6
cols = 2
layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                     ncol = cols, nrow = ceiling(numPlots/cols))



# colors correspond to data column
Variable = c("red")
names(Variable) <- c("Measurement")
# x
p_x <- ggplot(df, aes(x=t)) + 
  geom_line(aes(y=x_meas,colour="red")) +
  geom_line(aes(y=x_pred,colour="blue")) +
  geom_line(aes(y=x,colour="green")) +
  #scale_colour_manual(values=c("red,blue,green")) +
  scale_fill_discrete(guide=FALSE) +
  guides(fill=FALSE) +
  #scale_fill_discrete(labels=c("Measurements", "Predictions", "State")) +
  xlab("Timestep") +
  ylab("") +
  ggtitle("X")
# y
p_y <- ggplot(df, aes(x=t)) + 
  geom_line(aes(y=y_meas, colour="red")) +
  geom_line(aes(y=y_pred, colour="blue")) +
  geom_line(aes(y=y, colour="green")) +
  scale_fill_discrete(guide=FALSE) +
  xlab("Timestep") +
  ylab("") +
  ggtitle("Y")
# xdot
p_xdot <- ggplot(df, aes(x=t)) + 
  geom_line(aes(y=xdot_meas, colour="red")) +
  geom_line(aes(y=xdot_pred, colour="blue")) +
  geom_line(aes(y=xdot, colour="green")) +
  scale_fill_discrete(guide=FALSE) +
  xlab("Timestep") +
  ylab("") +
  ggtitle("X Velocity")
# ydot
p_ydot <- ggplot(df, aes(x=t)) + 
  geom_line(aes(y=ydot_meas, colour="red")) +
  geom_line(aes(y=ydot_pred, colour="blue")) +
  geom_line(aes(y=ydot, colour="green")) +
  scale_fill_discrete(guide=FALSE) +
  xlab("Timestep") +
  ylab("") +
  ggtitle("Y Velocity")
# theta
p_theta <- ggplot(df, aes(x=t)) + 
  geom_line(aes(y=theta_meas, colour="red")) +
  geom_line(aes(y=theta_pred, colour="blue")) +
  geom_line(aes(y=theta, colour="green")) +
  scale_fill_discrete(guide=FALSE) +
  xlab("Timestep") +
  ylab("") +
  ggtitle("Heading")
# yaw_rate
p_yr <- ggplot(df, aes(x=t)) + 
  geom_line(aes(y=yaw_rate_meas, colour="red")) +
  geom_line(aes(y=yaw_rate_pred, colour="blue")) +
  geom_line(aes(y=yaw_rate, colour="green")) +
  scale_fill_discrete(guide=FALSE) +
  xlab("Timestep") +
  ylab("") +
  ggtitle("Yaw Rate")
# plot them all
# p_x
# p_y
# p_xdot
# p_ydot
# p_theta
# p_yr
multiplot(p_x,p_y,p_xdot,p_ydot,p_theta,p_yr, cols=2)
```









