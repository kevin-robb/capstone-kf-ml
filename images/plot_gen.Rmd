---
title: "Plot Generation"
author: "Kevin Robb"
date: "12/8/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Disclaimer

This file is for making plots to demonstrate points I make in talks and the design proposal about lag errors and overfitting. This data is not real and is being generated; I am NOT using it to proclaim fraudulent results or anything unethical. Ok now that that's out of the way, let's make some plots.

# Make noise

```{r}
noise = runif(20, min=-3, max=3)
x = c(1:20)
plot(x,noise)
```


# Make data

```{r}
x = c(1:20)
y_true = x
y_meas = y_true + noise
plot(x,y_meas)
lines(x,y_true)
```

# Make State for high Q (overfitting)

```{r}
# follow the measurements
y_state = y_true + 0.75 * noise
plot(x,y_meas)
lines(x,y_true)
lines(x,y_state)
```

# Make State for appropriate Q

```{r}
# decrease reliance on measurements over time (converge to truth)
confidence = c(1:20)
y_state = y_true + (20 - confidence) / 20 * noise
plot(x,y_meas)
lines(x,y_true)
lines(x,y_state)
```

# Make State for low Q (lag error)

```{r}
# fall behind measurements
y_state = 0.6 * y_true + 0.1 * noise
plot(x,y_meas)
lines(x,y_true)
lines(x,y_state)
```



# Do plotting stuff

```{r}
filename = "q_demo"
library(reshape2)
library(ggplot2)
library(grid)
library(gridExtra)
library(cowplot)

# use the data from above to make a dataframe
df <- data.frame(x,y_true,y_meas,y_state)
names(df) <- c("Time","Truth","Measurement","State")


# change the names of df_x since they will be used for the legend
df_x_pre <- df[,c(1,2,6,10,14)]
names(df_x_pre) <- c("t","Measured","Predicted","State","Truth")

# subset each variable
df_x = melt(df_x_pre, id=c("t"))
df_y = melt(df[,c(1,3,7,11,15)], id=c("t"))
df_xdot = melt(df[,c(1,4,8,12,16)], id=c("t"))
df_ydot = melt(df[,c(1,5,9,13,17)], id=c("t"))

# define the first plot (x-position)
p_x <- ggplot(df_x) + geom_line(aes(x=t,y=value,colour=variable)) +
  scale_colour_manual(values=c("red","blue","green","black")) +
  ggtitle("X Position") + 
  cowplot::theme_minimal_grid(12) +
  theme(axis.text.x = element_text(size = 8, angle = 90, vjust = 0.5),axis.text.y = element_text(size = 8, vjust = 0.5)) +
  theme(plot.title = element_text(size=12))
# save the legend before suppressing it
legend <- cowplot::get_legend(p_x)
p_x <- p_x + theme(legend.position="none") + ylab("") + xlab("timestep")

# define all the other plots (w/o legend)
p_y <- ggplot(df_y) + geom_line(aes(x=t,y=value,colour=variable)) +
  scale_colour_manual(values=c("red","blue","green","black")) +
  ggtitle("Y Position") + ylab("") + xlab("timestep") +
  cowplot::theme_minimal_grid(12) + theme(legend.position="none") +
  theme(axis.text.x = element_text(size = 8, angle = 90, vjust = 0.5),axis.text.y = element_text(size = 8, vjust = 0.5)) +
  theme(plot.title = element_text(size=12))
p_xdot <- ggplot(df_xdot) + geom_line(aes(x=t,y=value,colour=variable)) +
  scale_colour_manual(values=c("red","blue","green","black")) + ylab("") + xlab("timestep") +
  ggtitle("X Velocity") + theme_minimal_grid(12) + theme(legend.position="none") +
  theme(axis.text.x = element_text(size = 8, angle = 90, vjust = 0.5),axis.text.y = element_text(size = 8, vjust = 0.5)) +
  theme(plot.title = element_text(size=12))
p_ydot <- ggplot(df_ydot) + geom_line(aes(x=t,y=value,colour=variable)) +
  scale_colour_manual(values=c("red","blue","green","black")) + ylab("") + xlab("timestep") +
  ggtitle("Y Velocity") + theme_minimal_grid(12) + theme(legend.position="none") +
  theme(axis.text.x = element_text(size = 8, angle = 90, vjust = 0.5),axis.text.y = element_text(size = 8, vjust = 0.5)) +
  theme(plot.title = element_text(size=12))

# draw the robot's path (measured and true)
#df_t = df[,c(1,2,8,14,20,3,9,15,21)]
#names(df_t) <- c("t","x_meas","x_pred","x","x,true","y_meas","y_pred","y","y_true")
```


